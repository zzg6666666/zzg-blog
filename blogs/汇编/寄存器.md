---
title: 寄存器
date: 2024/4/29
tags:
 - 寄存器
categories:
 - stm32
---

## 寄存器组

cortex m3 寄存器有R0 - R15的寄存器组

### 通用寄存器

R0 - R12都是通用寄存器，用于数据操作，R0 - R7是低寄存器，R8 - R12是高寄存器。

### 特殊寄存器

| 寄存器 | 别名                | 作用                                               |
| ------ | :------------------ | -------------------------------------------------- |
| R13    | SP(Stack Pointer)   | 栈指针，保存栈的地址                               |
| R14    | LR(Link Register)   | 连接寄存器，用于保存返回地址                       |
| R15    | PC(Program Counter) | 程序计数器，用于保存当前指令地址，写入新值即可跳转 |

其中SP寄存器较为特殊，cortex-M3拥有两个堆栈指针，处理器会自己选择合适的SP寄存器，也可以使用msr / mrs精确的访问这两个寄存器。

* Main Stack Pointer : `MSP(主堆栈指针)`，是程序复位后默认使用的堆栈指针，用于处理中断和系统模式下的堆栈管理。

* Process Stack Pointer:`PSP(程序堆栈指针)`用户代码模式下处理

## 特殊功能寄存器

这些寄存器只能被MSR/MRS指令访问

| 寄存器                    | 别名             |
| :------------------------ | ---------------- |
| xpsr                      | 程序状态寄存器   |
| primask\baskpri\faultmask | 中断屏蔽寄存器组 |
| control                   | 控制寄存器       |

xpsr寄存器在内部又被分为三个子状态寄存器


|寄存器|作用|
|:---|---|
|APSR (应用程序PSR) |有汇编标志的N、Z、C、V、Q|
|IPSR(中断号PSR)  |存有处理器正在处理的异常编号 |
| EPSR(执行PSR)|中断继续指令位(IF_THEN)和Thumb状态 |

它们能被单独访问，也可以合成一个xpsr寄存器，合并访问

![pkGEVk6.png](https://s21.ax1x.com/2024/06/01/pkGEVk6.png)

其他寄存器

| 寄存器    | 功能                                                       |
| :-------- | ---------------------------------------------------------- |
| primask   | 1位宽的寄存器，能关闭除了 NMI 和 硬件 fault 以外的所有异常 |
| baskpri   | 关闭能所有优先级不高于某个具体数值的中断                   |
| faultmask | 关闭除了 NMI 之外的所有的异常                              |
| control   | 决定当前使用哪一个堆栈指针                                 |
